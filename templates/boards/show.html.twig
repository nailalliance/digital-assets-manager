{% extends 'base.html.twig' %}

{% block title %}{{ board.name }}{% endblock %}

{% block body %}
    <div {{ stimulus_controller('board', { boardId: board.id }) }} class="flex h-screen bg-gray-100 overflow-hidden relative">
        {# Left-hand Toolbar #}
        <div class="absolute top-1/2 -translate-y-1/2 left-4 z-20 bg-white shadow-lg rounded-lg p-2 flex flex-col space-y-2">
            <button data-action="click->board#activateTool" data-tool="select" class="board-tool p-2 rounded hover:bg-gray-200" title="Select Tool">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13l6 6"></path></svg>
            </button>
            <button data-action="click->board#activateTool" data-tool="text" class="board-tool p-2 rounded hover:bg-gray-200" title="Add Text">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7V4h16v3m-5 13h-6m-4-6h16"></path></svg>
            </button>
            <button data-action="click->board#activateTool" data-tool="group" class="board-tool p-2 rounded hover:bg-gray-200" title="Add Group Box">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h18v18H3z"></path></svg>
            </button>
            <button data-action="click->board#activateTool" data-tool="line" class="board-tool p-2 rounded hover:bg-gray-200" title="Draw Line">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14"></path></svg>
            </button>
            <button data-action="click->board#activateTool" data-tool="arrow" class="board-tool p-2 rounded hover:bg-gray-200" title="Draw Arrow">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
            </button>
            <hr class="my-1 border-gray-200">
            <button data-action="click->board#frameContent" class="board-tool p-2 rounded hover:bg-gray-200" title="Center Content">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"></path></svg>
            </button>
        </div>

        {# Context Toolbars Container #}
        <div class="absolute top-4 left-4 z-20 flex space-x-2">
            {# General Context Toolbar (Layers) #}
            <div data-board-target="contextToolbar" class="bg-white shadow-lg rounded-lg p-1 flex space-x-1 hidden">
                <button data-action="click->board#bringForward" class="board-tool p-2 rounded hover:bg-gray-200" title="Bring Forward"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg></button>
                <button data-action="click->board#sendBackward" class="board-tool p-2 rounded hover:bg-gray-200" title="Send Backward"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg></button>
                <button data-action="click->board#bringToFront" class="board-tool p-2 rounded hover:bg-gray-200" title="Bring to Front"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8l7-7 7 7"></path></svg></button>
                <button data-action="click->board#sendToBack" class="board-tool p-2 rounded hover:bg-gray-200" title="Send to Back"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 16l-7 7-7-7"></path></svg></button>
            </div>

            {# Text-Specific Context Toolbar #}
            <div data-board-target="textContextToolbar" class="bg-white shadow-lg rounded-lg p-1 flex space-x-2 items-center hidden">
                {# Font Family #}
                <select data-action="change->board#changeTextStyle" data-style-property="fontFamily" data-board-target="fontFamilySelect" class="text-sm rounded border-gray-300 focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="Helvetica, sans-serif">Helvetica</option>
                    <option value="Times, serif">Times</option>
                </select>
                {# Font Size #}
                <input type="number" data-action="input->board#changeTextStyle" data-style-property="fontSize" data-board-target="fontSizeInput" class="w-16 text-sm rounded border-gray-300 focus:ring-indigo-500 focus:border-indigo-500" min="8" max="120">
                {# Bold/Italic #}
                <button data-action="click->board#toggleTextStyle" data-style-property="fontWeight" data-style-value="bold" data-board-target="boldButton" class="board-tool p-2 rounded hover:bg-gray-200" title="Bold">B</button>
                <button data-action="click->board#toggleTextStyle" data-style-property="fontStyle" data-style-value="italic" data-board-target="italicButton" class="board-tool p-2 rounded hover:bg-gray-200 italic" title="Italic">I</button>
                {# Text Align #}
                <button data-action="click->board#changeTextStyle" data-style-property="textAlign" data-style-value="left" class="board-tool p-2 rounded hover:bg-gray-200" title="Align Left"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h18M3 8h18M3 12h12M3 16h18M3 20h12"></path></svg></button>
                <button data-action="click->board#changeTextStyle" data-style-property="textAlign" data-style-value="center" class="board-tool p-2 rounded hover:bg-gray-200" title="Align Center"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h18M3 8h18M6 12h12M3 16h18M6 20h12"></path></svg></button>
                <button data-action="click->board#changeTextStyle" data-style-property="textAlign" data-style-value="right" class="board-tool p-2 rounded hover:bg-gray-200" title="Align Right"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h18M3 8h18M9 12h12M3 16h18M9 20h12"></path></svg></button>
                {# Colors #}
                <input type="color" data-action="input->board#changeTextStyle" data-style-property="color" data-board-target="colorInput" title="Font Color" class="w-8 h-8 p-0 border-none">
                <input type="color" data-action="input->board#changeTextStyle" data-style-property="backgroundColor" data-board-target="backgroundColorInput" title="Background Color" class="w-8 h-8 p-0 border-none">
                <input type="color" data-action="input->board#changeTextStyle" data-style-property="borderColor" data-board-target="borderColorInput" title="Border Color" class="w-8 h-8 p-0 border-none">
            </div>
        </div>

        {# Item Context Toolbar (New) #}
        <div data-board-target="contextToolbar" class="absolute top-4 left-4 z-20 bg-white shadow-lg rounded-lg p-2 flex space-x-2 hidden">
            <button data-action="click->board#bringForward" class="board-tool p-2 rounded hover:bg-gray-200" title="Bring Forward">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
            </button>
            <button data-action="click->board#sendBackward" class="board-tool p-2 rounded hover:bg-gray-200" title="Send Backward">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
            </button>
            <button data-action="click->board#bringToFront" class="board-tool p-2 rounded hover:bg-gray-200" title="Bring to Front">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8l7-7 7 7"></path></svg>
            </button>
            <button data-action="click->board#sendToBack" class="board-tool p-2 rounded hover:bg-gray-200" title="Send to Back">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 16l-7 7-7-7"></path></svg>
            </button>
        </div>

        {# Main Board Area #}
        <div id="board-viewport" class="flex-grow h-full bg-gray-200 relative overflow-hidden" data-action="wheel->board#handleZoom" data-board-target="viewport">
            <div id="board-canvas" data-board-target="canvas" class="absolute top-0 left-0">
                {# Items will be dynamically added here #}
            </div>
            <svg data-board-target="svgCanvas" class="absolute top-0 left-0 w-full h-full pointer-events-none z-10">
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" />
                    </marker>
                </defs>
                {# Lines and arrows will be drawn here #}
            </svg>

            {# Top Right Controls #}
            <div class="absolute top-4 right-4 z-20 flex space-x-2 items-center">
                <button data-action="click->board#zoomIn" class="px-3 py-1 bg-white text-gray-800 rounded shadow hover:bg-gray-100" title="Zoom In">+</button>
                <span data-board-target="zoomValue" class="text-sm text-gray-700 bg-white px-2 py-1 rounded shadow">100%</span>
                <button data-action="click->board#zoomOut" class="px-3 py-1 bg-white text-gray-800 rounded shadow hover:bg-gray-100" title="Zoom Out">-</button>
                <button data-board-target="saveBtn" id="save-board-btn" class="ml-4 px-4 py-2 bg-blue-500 text-white rounded shadow hover:bg-blue-600">Save</button>
                <button id="download-all-btn" class="px-4 py-2 bg-green-500 text-white rounded shadow hover:bg-green-600">Download All</button>
            </div>
        </div>

        {# Right-hand Asset Panel #}
        <div id="asset-panel" class="w-80 h-full bg-gray-50 border-l border-gray-200 p-4 overflow-y-auto z-20">
            <h2 class="text-lg font-bold mb-4">Assets</h2>
            <div class="mb-4">
                <input type="text" data-board-target="assetSearch" id="asset-search" placeholder="Search assets..." class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div data-board-target="assetList" id="asset-list">
                {# Asset search results will be loaded here #}
            </div>
        </div>
    </div>
{% endblock %}

